# NOTE: Refer drone Go example http://readme.drone.io/0.5/usage/golang-example/
workspace:
  base: /go
  path: src/github.com/josebarn/drone-with-go

pipeline:
  build:
  build:
    image: golang:${GO_VERSION}
    commands:
      - go get ./...
      - go build
    debug: true

  unit-test:
    image: golang:${GO_VERSION}
    commands:
      - go test ./api

  publish:
    image: plugins/docker
    repo: josebarn/hello-world
    tags: [ 1.0.0, 1.0, latest ]
    dockerfile: ./docker/Dockerfile
    secrets: [ DOCKER_USERNAME, DOCKER_PASSWORD ]
#    debug: true

matrix:
 GO_VERSION:
   - latest
   - "1.7"
   - "1.6"
